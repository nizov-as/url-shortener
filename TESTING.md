# üìä TESTING.md

## üìö –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
–í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –±–∞–∑–µ **pytest** –∏ **httpx.AsyncClient** –≤ —Å–≤—è–∑–∫–µ —Å **FastAPI**. –í—Å–µ —Ç–µ—Å—Ç—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ —á–µ—Ä–µ–∑ `docker-compose.test.yml`.

---

## ‚öñÔ∏è –°—Ç–µ–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **pytest** ‚Äî –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
- **pytest-asyncio** ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ async-—Ç–µ—Å—Ç–æ–≤
- **httpx.AsyncClient** ‚Äî HTTP-–∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API
- **Docker / docker-compose** ‚Äî –∏–∑–æ–ª—è—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤
- **PostgreSQL + Redis** ‚Äî —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö

---

## ‚öôÔ∏è –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
docker-compose -f docker-compose.test.yml up --build
```

–≠—Ç–æ –ø–æ–¥–Ω–∏–º–∞–µ—Ç:
- `db_test` ‚Äî PostgreSQL
- `redis_test` ‚Äî Redis
- `test_app` ‚Äî —Ç–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä `test_app` –≤—ã–ø–æ–ª–Ω—è–µ—Ç:
1. `alembic upgrade head`
2. `pytest`

---

## üî¢ –û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

### tests/test_create_short_link.py
- `test_create_short_link` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ø–µ—à–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–∫—Ä–∞—â–µ–Ω–Ω–æ–π —Å—Å—ã–ª–∫–∏ —á–µ—Ä–µ–∑ `POST /links/shorten`

> –î—Ä—É–≥–∏–µ —Ç–µ—Å—Ç—ã (—Ä–µ–¥–∏—Ä–µ–∫—Ç, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –ø–æ–∏—Å–∫, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –æ—à–∏–±–∫–∏) –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ —Å–ª–µ–¥—É—é—â–∏—Ö —ç—Ç–∞–ø–∞—Ö.

---

## üìä –ü–æ–∫—Ä—ã—Ç–∏–µ

–ù–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç –ø–æ–∫—Ä—ã—Ç –±–∞–∑–æ–≤—ã–π happy-path —Å—Ü–µ–Ω–∞—Ä–∏–π:
- [x] –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–∏

–û—Å—Ç–∞–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø–æ–∫–∞ –Ω–µ –ø–æ–∫—Ä—ã—Ç:
- [ ] –†–µ–¥–∏—Ä–µ–∫—Ç –ø–æ —Å—Å—ã–ª–∫–µ
- [ ] –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- [ ] –ü–æ–∏—Å–∫ –ø–æ URL
- [ ] –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è / —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ / —É–¥–∞–ª–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

---

## üì¶ –§–∞–π–ª—ã —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- `docker-compose.test.yml` ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤
- `tests/conftest.py` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- `.env.test` ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤ (–Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ git)

---

## üîê –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ

–ù–µ –∑–∞–±—É–¥—å—Ç–µ —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `.env.test` —Å –Ω—É–∂–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, URL —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î).

```env
DATABASE_URL=postgresql+asyncpg://postgres:postgres@db_test:5432/test_url_shortener
REDIS_URL=redis://redis_test:6379/0
```

–î–æ–±–∞–≤—å—Ç–µ `.env.test` –≤ `.gitignore`, —á—Ç–æ–±—ã –Ω–µ –ø—É—à–∏—Ç—å –µ–≥–æ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

